# PHP（掲示板）編　まとめ

全体を振り返る。このページだけ見れば必要な段取りが分かるようにしておく。感想は最後。

## 最終形

https://github.com/take5553/php-bbs/tree/Complete

## 必要なもの

* 本番環境

  * WebサーバーとPHP

    * Apacheの場合はPHP本体（必要に応じてモジュール（`mb_string`等））
    * Nginxの場合はPHP-FPMとPHP本体（とモジュール）

  * DB

    MySQLまたはMariaDB

  * ファイルアップロードシステム

    今回はGitとGitHubを使ったが、手軽さ重視ならFTPとかでもOK

  * XDebug

    ローカルにもリモートにも必要

* 開発環境

  * XAMPP

    バージョンは最新がいいけど、`php_xdebug.dll`が付属してなければバージョンを一つ落とす。

  * VSCodeと拡張機能

    * GitGraph
    * PHP Intelephense
    * PHP Debug
    * php cs fixer
    * Bracket Pair Colorizer 2
    * その他任意で

  * テストフレームワーク

    * Composer
    * PHP Unit

## ファイル構成

ドキュメントルート

* index.php

  コントローラーとして。規模が大きくなればcontrollerフォルダを作成。

* viewフォルダ

  フロントに徹する

* modelフォルダ

  バックに徹する

* configフォルダ

  + 本番環境用パラメーターファイル
  + 開発環境用パラメーターファイル（アップしない）

* libフォルダ

  modelとは言えないちょっとした関数とか

* testフォルダ

  テストコード置き場

## 設計

* モデル

  * PostクラスとPostsクラス（今回未作成）

    記事データを担当

  * DBOperationクラス

    DB操作を担当

  * DBTableInfoクラス（今回未作成）

    DB内のテーブルのカラム情報を保持し、Postクラスと連携を取る

* ビュー

  * 記事閲覧画面
    * 入力フォーム
    * 閲覧エリア
    * ページネーション（今回未作成）
    * コメント機能（今回未作成）
  * 記事編集画面
  * 記事削除画面（今回未作成）
  * エラー表示画面

## セキュリティ

* XSS
* CSRF
* SQLインジェクション
* パスワードハッシュ
* クリッキングジャック
* IP記録などの荒らし対策（今回未作成）

## TDD

テストを先に書くならば

- コードレベル
  - メソッドの名前
  - 引数
  - 戻り値
- 設計レベル
  - 正常処理後の状態
  - エラー処理後の状態

を先に決める。

## テストについて

* 正常系・準正常系・異常系
* 同値分割・境界値分析
* カバレッジ：命令網羅（C0）、分岐網羅（C1）、条件網羅（C2）
* ホワイトボックス・ブラックボックス
* 制御フローテスト・データフローテスト

## データベースとのやり取り

* 接続（PDOオブジェクト作成）
  * DSN設定
    * DBの種類（MySQLとかPostgreとか）
    * DBの名前
    * DBのホスト（`localhost`とか）
    * 文字セット（`utf8`）
  * DBのユーザー
  * DBのユーザーのパスワード
* 属性設定（`setAttribute`）
* SQL文発行
  * プリペアードステートメント作成
  * 値をバインド
  * 実行
  * `SELECT`文ならその後、`fetch`または`fetchAll`でデータ取得

データベースが扱えたら業務システムとかも作れそう。

## 感想

### 「俺PHPできるよ」と言える

まあ本当にガチでPHPやってる人からすればペーペーかもしれないけど、だからと言って「PHPできない」訳ではない。「できる」をどう捉えるかは人それぞれで、大きすぎる期待は裏切ってしまうかもしれないけど、できない人ではない。

### スピードが必要

独学でゆっくり進めた（2ヶ月半）けど、次以降（特にDB使う系）はもっと速く作りたい。

### フレームワークに進みたい

もしLaravelなんかのフレームワークを使ったらもっと早く完成するんだろうか。

### もし最後までついてきた人がいたら

こんな試行錯誤ばっかりの開発記を最後まで辿ってくれてありがとう。