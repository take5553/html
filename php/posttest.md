# 投稿機能のテストを書く

TDDやるぞと言っておきながら投稿機能は先に作っちゃったので、逆に「どういう風に考えておけば先にテストが書けるのか」ということを考察していきたい。

## 環境

- ローカル
  - Windows 10
  - VSCode 1.51.1
  - XAMPP 7.4.13
  - MariaDB 10.4.17
- リモート
  - Raspberry Pi 3B+
  - Raspberry Pi OS 10.4
  - Nginx 1.14.2
  - PHP 7.3.19-1~deb10u1
  - MariaDB 10.3.23

## 準備

`GetFormAction`クラスのテストを書くので、`GetFormActionTest`クラスとなる。`test/GetFormActionTest.php`を作成。

（`TestTestTest.php`を参考にしたら`Test`を頭に付けるのかお尻に付けるのか分からなくなってしまった。）

![image-20201224220840626](image/posttest/image-20201224220840626.png)

次に`GetFormActionTest.php`の中にそのクラスを作り、`SaveDBPostData`をテストするメソッド`testSaveDBPostData`を作成。その中で対象のクラスのインスタンスを生成しておく。

~~~php
<?php

use PHPUnit\Framework\TestCase;

require('model/GetFormAction.php');

class GetFormActionTest extends TestCase{

    public function testSaveDBPostData(){
        $action = new GetFormAction();
        
    }

}
~~~

ということはテストを書く時点で

* クラス名
* メソッド名

を決めておかないといけないということになる。

## テスト内容を考える

ここで思い出したいのが、

- 正常系・準正常系・異常系
- 同値分割・境界値分析

という考え方。

今回の「記事投稿」という機能に限って言えば

* 正常系・・・正常に投稿できる
* 準正常系・・・異常状態を正しく認識し、ちゃんと回避できるか
* 異常系・・・「いや、ちょっとそんな投稿、ありえへんやん？」な時の挙動

と分類できる。

正常系はいいとして、異常系はもとより準正常系すら考えていなかったことがここで分かる。

### 準正常系

準正常系のテストを考えるということは、「こんな投稿は禁止する」ということを考えることになる。

例えば、以下の投稿はDBにデータを追加しないようにする。

* 名前・Email・本文・パスワードのどれかが一つでも欠けている
* パスワードが4文字未満

みたいな感じ。メールアドレスに対する制限は・・・ええでしょ別に。

### 異常系

これは難しい。例えば

* 名前が100文字以上
* 名前が画像データ

とか？名前が画像て、意味分からんけど・・・どうやってテストするのかも分からんけど・・・

### 同値分割・境界値分析

今回は文字列を受け入れるので、同値分割・境界値分析の考え方は当てはめにくい。ということは逆にこの考え方は数値のような連続性のあるデータを扱う時に使える、ということか。