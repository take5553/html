# テストの世界

[前回](testanddebug.html)でテストが成功しこれで大丈夫かと思いきや、まだまだ先があるという話。

## 環境

- ローカル
  - Windows 10
  - VSCode 1.51.1
  - XAMPP 7.4.13
  - XDebug 2.8.1
  - PHPUnit 9.0.0

## テストを変更

`testtestAdd`を以下のように変更。

~~~php
    public function testtestAdd()
    {
        $testtest = new TestTest;
        $this->assertEquals(1, $testtest->testAdd(2, -1));
    }
~~~

`2 + (-1) = 1`でしょ。

ところが、テストをしてみると失敗する。

~~~
> ./phpunit tests/
PHPUnit 9.0.0 by Sebastian Bergmann and contributors.

.F                                                                  2 / 2 (100%)

Time: 00:26.167, Memory: 4.00 MB

There was 1 failure:

1) TestTestTest::testtestAdd
Failed asserting that 2 matches expected 1.

C:\work\html\raspberrypi-server\test\html\php-bbs\tests\TestTestTest.php:18

FAILURES!
Tests: 2, Assertions: 2, Failures: 1.
~~~

まあ足し算と言いながら引き算しているので失敗するのは当然なのかもしれないけど、`testAdd`の引数は`int`型なので負の数も許してしまう。つまり`testAdd`は不具合を起こす可能性を含んでいる。

でも[前回](testanddebug.html)のテストでは`100%`と出てすべてのテストは成功している。

ということは、前回のテストは不具合の可能性を見つけられないテストだった、ということになる。

## 良いテストとは

何かの処理に対するテストとして「どんなテストを行うか」というのはとても大事。でも良いテストはどうやったら書けるのかというのは難しい問題。

とりあえずテストに対する考え方のとっかかりとして

* 正常系・準正常系・異常系
* 同値分割・境界値分析

というものがある。

### 正常系・準正常系・異常系

* 正常系・・・正常値で正しく動くか
* 準正常系・・・想定内の異常値でちゃんと異常値用の処理をしているか
* 異常系・・・想定外の完全な異常値に対してどういう処理をするのか

正常系と準正常系はどちらも想定しているのでテストは思いつきやすいけど、異常系は「想定外の完全な異常値って何？」となる。想定していないから想定外なわけで、想定出来たら仕様に入れ込んで準正常系としてテストできちゃうでしょ。

また正常系も、一つ調べれば良いというわけではなく、結果が複数パターンあるなら複数回試さないと本当に大丈夫なのか分からない。とは言っても全パターンを試すのはやりすぎだったりする。

### 同値分割・境界値分析

どちらも入力値に関する考え方。

* 同値分割・・・入力値を、結果のパターンが同じものでグループ分けし、そのグループから適当に代表値を選びそれをテストの入力値とする
* 境界値分析・・・入力値をグループ分けしたときの境界値とその前後の値に注目してテストする

`testAdd`の例でいえば入力値を正の数、0、負の数とグループ分けができるから、境界値分析時の入力値として`1`、`0`、`-1`とかその辺りが使えるかもしれない。

### その他

詳しく見ていくともう少し色々な観点がある。

#### カバレッジ

考えられうる全パターンの処理のうち、どれだけのパターンがテストでカバーされているか。パターンの数え方として

* 命令網羅（C0）
* 分岐網羅（C1）
* 条件網羅（C2）

というものがある。

#### ホワイトボックステスト・ブラックボックステスト

コードの中身を知っている人がテストを書くか、中身を全く知らない人が仕様書のみに基づいてテストを書くか、とかそんな感じ

#### 制御フローテスト・データフローテスト

処理の流れに注目するか、データの流れに注目するか。

## まとめ

奥が深い。

※調べるのが面倒になった

## 参考

正常系・異常系
[初心者エンジニアがたどり着いたテスト仕様書の書き方 \- Qiita](https://qiita.com/nnahito/items/a664d89ff8a6c7a741b2)
[「正常系」・「準正常系」・「異常系」テストについて、まとめてみました。 \- ヒャッハー！ふっくら太郎です。](http://gokushiteki-softtest.hatenablog.com/entry/2017/09/09/170828)

同値分割・境界値分析
[失敗しないテストケースの作り方と、効率よくテストを進める方法 \| クラウド型テスト管理ツール「Qangaroo（カンガルー）」](https://qangaroo.jp/info/test-case-plan-do/)
[テストケースの作成 \- Qiita](https://qiita.com/salvage0707/items/b15412af6951da2069ba)

カバレッジ
[ホワイトボックステストにおけるカバレッジ（C0/C1/C2/MCC）について \- Qiita](https://qiita.com/bremen/items/8b6542467d2a0066e5af)
[ホワイトボックステストにおけるカバレッジとテストケース\(C0, C1, C2, CDC, MC/DC, MCC\) \- ろぐれこーど](https://dlrecord.hatenablog.com/entry/2020/04/29/201223)
[カバレッジ\(網羅率\)分析とは \| ソフトウェアの検証の種類 \| テクマトリックス株式会社](https://www.techmatrix.co.jp/t/quality/coverage.html)

ホワイトボックステスト・ブラックボックステスト
[みんな知ってるホワイトボックステスト、ブラックボックステスト。でもグレーボックステストとは…？ \| ハートランド・ザ・ワールド](https://hldc.co.jp/blog/2018/05/25/1387/#:~:text=%E3%83%9B%E3%83%AF%E3%82%A4%E3%83%88%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E3%81%AF,%E9%96%8B%E7%99%BA%E8%80%85%E3%81%8C%E8%A1%8C%E3%81%84%E3%81%BE%E3%81%99%E3%80%82)
[ホワイトボックステスト～概要、技法、テスト観点について～ \| ソフトウェアテスト・第三者検証ならウェブレッジ](https://webrage.jp/techblog/white_box_testing/)

制御フローテスト・データフローテスト
[ソフトウェア機能テスト手法まとめ \- Qiita](https://qiita.com/yokoc1322/items/d7b4ad158698fd80f827)
[テストの種類と技法 \- Qiita](https://qiita.com/ktarow/items/8c3d94d6c21a0c86b799)
